<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Compliance Audit Vault</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            padding: 2rem;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            color: #22c55e;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: #94a3b8;
            margin-bottom: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #1e293b;
            border-radius: 8px;
            overflow: hidden;
        }

        th,
        td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #334155;
        }

        th {
            background: #0f172a;
            color: #94a3b8;
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        tr:hover {
            background: #334155;
        }

        .tag {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .tag-approved {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }

        .tag-rejected {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        .raw-json {
            font-family: monospace;
            font-size: 0.8rem;
            color: #94a3b8;
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üîê Audit Vault Compliance Log</h1>
        <p class="subtitle">Immutable record of all risk decisions (Read-Only).</p>

        <div id="loading">Loading blockchain records...</div>
        <table id="logsTable" style="display:none;">
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>Borrower ID (Hash)</th>
                    <th>Decision</th>
                    <th>Risk Score</th>
                    <th>Model Outputs</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <script>
        async function loadLogs() {
            const token = localStorage.getItem('token');
            if (!token) return window.location.href = '/login.html';

            try {
                const res = await fetch('/v1/compliance/report', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!res.ok) throw new Error('Unauthorized Access');

                const data = await res.json();
                const logs = data.logs || [];

                document.getElementById('loading').style.display = 'none';
                document.getElementById('logsTable').style.display = 'table';

                const tbody = document.getElementById('tableBody');

                logs.forEach(log => {
                    const decision = log.outputs?.approved ? 'APPROVED' : 'REJECTED';
                    const cssClass = log.outputs?.approved ? 'tag-approved' : 'tag-rejected';

                    const row = `
                        <tr>
                            <td>${new Date(log.timestamp).toLocaleString()}</td>
                            <td style="font-family:monospace">${log.borrowerId}</td>
                            <td><span class="tag ${cssClass}">${decision}</span></td>
                            <td>${log.outputs?.risk?.score || 'N/A'}</td>
                            <td class="raw-json">${JSON.stringify(log.outputs?.pricing || {}, null, 0).substring(0, 50)}...</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });

            } catch (err) {
                document.getElementById('loading').innerHTML = `<span style="color:red">Error: ${err.message}</span>`;
            }
        }

        loadLogs();
    </script>
</body>

</html>